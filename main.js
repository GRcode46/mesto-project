(()=>{"use strict";var e="".concat("https://nomoreparties.co","/").concat("v1","/").concat("plus-cohort-15","/"),t={},n={authorization:"b3089888-aa79-46f6-807a-8b107b401124","Content-Type":"application/json"},o="cards",r="".concat(o,"/likes"),c="users/me",i="".concat(c,"/avatar"),a=document.querySelectorAll(".button__popup-close"),u=document.querySelector("#edit-card-btn-submit"),l=document.querySelector(".profile"),s=l.querySelector(".profile__btn-edit"),d=l.querySelector(".profile__title"),f=l.querySelector(".profile__subtitle"),p=l.querySelector(".profile__avatar"),m=document.querySelector("#popup-profile"),v=document.querySelector("#profile-popup-form"),_=v.querySelector("#popup-profile-title"),y=v.querySelector("#popup-profile-subtitle"),S=document.querySelector("#edit-profile-btn-submit"),h=document.querySelector("#popup-element"),b=document.querySelector("#card-popup-form"),q=document.querySelector(".profile__btn-add"),L=document.querySelector("#element-name"),E=document.querySelector("#element-url"),k=document.querySelector(".elements__list"),C=document.querySelector("#element-template").content,g=document.querySelector("#popup-preview"),x=g.querySelector(".popup-preview__image"),w=g.querySelector(".popup-preview__title"),A=document.querySelector("#popup-card-delete-confirmation"),T=A.querySelector("#card-del-btn-submit"),B=l.querySelector(".profile__avatar-btn"),D=document.querySelector("#popup-avatar"),P=document.querySelector("#edit-avatar-btn-submit"),j=document.querySelector("#avatar-url"),N=document.querySelector("#avatar-popup-form");function O(e){return e.ok?e.json():Promise.reject(e)}function J(t){return fetch("".concat(e).concat(t),{headers:n}).then(O)}function z(t,o){return fetch("".concat(e).concat(t,"/").concat(o),{method:"DELETE",headers:n}).then(O)}function H(t,o){return fetch("".concat(e).concat(t),{method:"PATCH",headers:n,body:JSON.stringify(o)}).then(O)}function I(e){e.target===e.currentTarget&&F(e.target)}function M(e){"Escape"===e.key&&F(document.querySelector(".popup_opened"))}function U(e){e.classList.add("popup_opened"),window.addEventListener("keydown",M),e.addEventListener("click",I)}function F(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",M),e.removeEventListener("click",I)}var G,K=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)};function Q(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function R(e){J(e).then((function(e){p.src=e.avatar})).catch((function(e){console.log(e)}))}function V(o,c,i,a,u){var l=C.querySelector(".element").cloneNode(!0),s=l.querySelector(".element__btn-like"),d=l.querySelector(".element__image"),f=l.querySelector(".element__trash"),p=l.querySelector(".element__like-counter");return p.textContent=i.length,l.querySelector(".element__name").textContent=o,d.src=c,d.alt=o,s.addEventListener("click",(function(t){var o,c;t.target.classList.contains("element__btn-like_active")?z(r,u).then((function(e){p.textContent="".concat(e.likes.length),s.classList.remove("element__btn-like_active")})).catch((function(e){console.log(e)})):(o=r,c=u,fetch("".concat(e).concat(o,"/").concat(c),{method:"PUT",headers:n}).then(O)).then((function(e){p.textContent="".concat(e.likes.length),s.classList.add("element__btn-like_active")})).catch((function(e){console.log(e)}))})),a===t.id?(l.setAttribute("id",u),f.addEventListener("click",(function(){var e;e=u,U(A),T.setAttribute("data-id",e)}))):f.classList.add("element__trash_disabled"),d.addEventListener("click",(function(){var e,t;e=c,t=o,U(g),x.src=e,w.textContent=t,x.alt=t})),l}function W(e){k.prepend(e)}a.forEach((function(e){e.addEventListener("click",(function(e){F(e.target.closest("div.popup"))}))})),s.addEventListener("click",(function(){var e;e=m,_.value=d.textContent,y.value=f.textContent,U(e)})),q.addEventListener("click",(function(){U(h)})),h.addEventListener("submit",(function(t){t.preventDefault();var r={name:L.value,link:E.value};!function(t,o){Q(!0,u),function(t,o){return fetch("".concat(e).concat(t),{method:"POST",headers:n,body:JSON.stringify(o)}).then(O)}(t,o).then((function(e){W(V(e.name,e.link,e.likes,e.owner._id,e._id)),b.reset(),u.disabled=!0,u.classList.add("button_state_inactive"),F(h)})).catch((function(e){if(400===e.status){var t=b.querySelector(".element-url-error");t.classList.add("form__input-error_active"),t.textContent="Ошибка: ".concat(e.status),setTimeout((function(){t.classList.remove("form__input-error_active"),t.textContent=""}),3e3),console.log(e)}})).finally((function(){Q(!1,u)}))}(o,r)})),v.addEventListener("submit",(function(e){e.preventDefault();var t,n={name:_.value,about:y.value};t=n,Q(!0,S),H("users/me",t).then((function(e){d.textContent=e.name,f.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){Q(!1,S)})),F(m)})),T.addEventListener("click",(function(e){var t;z("cards",t=e.target.dataset.id).then((function(){document.getElementById(t).remove(),F(A)})).catch((function(e){console.log(e)}))})),B.addEventListener("click",(function(){j.value.reset,U(D)})),D.addEventListener("submit",(function(e){e.preventDefault();var t,n,o={avatar:j.value};console.log(o),t=i,n=o,Q(!0,P),H(t,n).then((function(){N.reset(),R(c)})).catch((function(e){console.log(e)})).finally((function(){Q(!1,P)})),F(D)})),G={formSelector:".popup__form",inputSelector:".form__input",submitButtonSelector:".popup__btn-submit",inactiveButtonClass:"button_state_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(G.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);K(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),K(n,o,t)}))}))}(e,G)})),function(e){J(e).then((function(e){d.textContent=e.name,f.textContent=e.about,t.id=e._id})).catch((function(e){console.log(e)}))}(c),R("users/me"),J("cards").then((function(e){e.reverse().forEach((function(e){W(V(e.name,e.link,e.likes,e.owner._id,e._id))}))})).catch((function(e){console.log(e)}))})();